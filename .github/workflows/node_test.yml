
name: Node.js CI

#on:
#  push:
#    branches: [ "gdrozda/npm-test" ]

on: issue_comment


jobs:
#  run_tests:
#    runs-on: ubuntu-latest
#    if: ${{ github.event.issue.pull_request && contains(github.event.comment.body, '#runtest') }}
#    strategy:
#      matrix:
#        node-version: [16.x]
#        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/
#
#    steps:
#    - uses: actions/checkout@v3
#    - name: Use Node.js ${{ matrix.node-version }}
#      uses: actions/setup-node@v3
#      with:
#        node-version: ${{ matrix.node-version }}
#        cache: 'npm'
#    - run: npm install
#    - run: npm test
#
  pr_comment:
    # This job only runs for pull request comments
    name: PR comment
    needs: run_tests
    if: always () && github.event.issue.pull_request && contains(github.event.comment.body, '#runtest')
    runs-on: ubuntu-latest
    steps:
      - name: PR comment with reactions
        uses: thollander/actions-comment-pull-request@v1
        with:
          message: |
            ### `npm test` result is **${{ needs.run_tests.result }}**
            * actions url: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}/
            * triggering comment url: ${{ github.event.comment.html_url }}
            * triggering user: [${{ github.event.comment.user.login }}](${{ github.event.comment.user.html_url }}) 
          #reactions: eyes, rocket
          pr_number: ${{ github.event.issue.number }}
        env:
          NUMBER: ${{ github.event.issue.number }}

