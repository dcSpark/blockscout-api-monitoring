name: Node.js CI

on: issue_comment


jobs:
  show-vars:
    name: Show environment variables
    runs-on: ubuntu-latest    
    steps:
      - name: Show variables
        run: echo '${{ toJSON(github) }}'  
  build-and-deploy:
    if: always () && github.event.issue.pull_request && contains(github.event.comment.body, '#runtest')
    uses: dcSpark/blockscout-api-monitoring/.github/workflows/build-workflow.yml@main
    with:
      REGISTRY: dcspark
      REPOSITORY: blockscout-api-monitoring
    secrets:
      DOCKERHUB_USERNAME: ${{ secrets.DOCKERHUB_USERNAME }}
      DOCKERHUB_TOKEN: ${{ secrets.DOCKERHUB_TOKEN }}
      RO_GITHUB_TOKEN: ${{ secrets.RO_GITHUB_TOKEN }}
  pr_comment:
    # This job only runs for pull request comments
    name: PR comment
    needs: build-and-deploy
    if: always () && github.event.issue.pull_request && contains(github.event.comment.body, '#runtest')
    runs-on: ubuntu-latest
    steps:
      - name: PR comment with reactions
        uses: thollander/actions-comment-pull-request@v1
        with:
          message: |
            ### New docker image in PR is created - use following name: result is **$REGISTRY/$REPOSITORY:latest**
            * actions url: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}/
            * triggering comment url: ${{ github.event.comment.html_url }}
            * triggering user: [${{ github.event.comment.user.login }}](${{ github.event.comment.user.html_url }}) 
          #reactions: eyes, rocket
          pr_number: ${{ github.event.issue.number }}
        env:
          NUMBER: ${{ github.event.issue.number }}



